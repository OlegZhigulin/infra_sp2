## Описание
YaMDb - это новый веб сервис, который собирает отзывы пользователей на различные произведения (книги, фильмы, музыку и т.д.) Через этот интерфейс могут работать мобильное приложение или чат-бот; через него же можно будет передавать данные в любое приложение или на фронтенд.

#### Реализован функционал, дающий возможность:
* Оставлять и редактировать отзывы на произведения.
* Комментировать отзывы и редактировать эти комментарии.
* Добавлять в базу данных новые произведения, категории, жанры (для прользователей с правами доступа Администратора) 
* Ставить оценки произведениям, видеть их рейтинг.

Для выполнения всех запросов существуют различные уровни доступа (автор поста/комментария, авторизованный пользователь, неавторизованный пользователь, модератор, администратор, суперюзер Django).

Механизм авторизации пользователей реализован с помощью JWT-токенов, причем токен пользователь получает после подтверждения своего e-mail 

### Технологии
``` 
Python 3.7
Django 2.2.19
DRF 3.12.4
docker-compose 3.8
```

# Endpoint:
- /auth   : аутентификация.
- /users   : пользователи.
- /genres   : жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
- /titles   : произведения, к которым пишут отзывы (определённый фильм, книга или песенка).
- /categories   : категории (типы) произведений («Фильмы», «Книги», «Музыка»).
- /comments   : комментарии к отзывам. Комментарий привязан к определённому отзыву.
- /reviews   : отзывы на произведения. Отзыв привязан к определённому произведению.



# инструкция по запуску и настройке

## в терминале выполнить команду:
git@github.com:OlegZhigulin/infra_sp2.git


## В переменную окружения .env добавить:
```{
DB_ENGINE=django.db.backends.postgresql # указываем, что работаем с postgresql
DB_NAME= # имя базы данных
POSTGRES_USER= # логин для подключения к базе данных
POSTGRES_PASSWORD= # пароль для подключения к БД (установите свой)
DB_HOST=db # название сервиса (контейнера)
DB_PORT=5432 # порт для подключения к БД }
```
## Перейти в папку infra и запустить docker-compose.yaml (при установленном и запущенном Docker)

cd infra_sp2/infra

## для запуска контейнера выполнить команду:

docker-compose up -d --build

## после успешного запуска подготовить миграции

docker-compose exec web python manage.py makemigrations

## и выполнить миграции

docker-compose exec web python manage.py migrate

## создать суперпользователя 

docker-compose exec web python manage.py createsuperuser

## и собрать статику

docker-compose exec web python manage.py collectstatic --no-input 

## Теперь проект доступен по адресу: http://localhost/admin/

# Примеры запросов к API Yatube:

### Получаем JWT-токен
На эндпоинт http://127.0.0.1:8000/api/v1/auth/signup/ передаем POST запрос с параметрами username и email. 
В ответ на указанный email получаем confirmation_code.
Далее, на эндпоинт http://127.0.0.1:8000/api/v1/auth/token/ передаем POST запрос с параметрами username и confirmation_code. В ответ получаем JWT-токен, который используем для выполнения запросов POST, DELETE, PATCH, PUT как авторизованный пользователь.

При отправке запроса передавайте токен в заголовке Authorization: Bearer <<токен>>

### Создаем новoe произведение 
Передаем POST-запрос на адрес http://127.0.0.1:8000/api/v1/titles/ 
Обязательные поля:   
```
{ 
    "name": "Красная шапочка",  
    "year": 1697,  
    "description": "Старинное произведение Ш.Перро",  
    "genre": [  
    "сказка"  
    ],  
    "category": "книга"  
}  
```
Ответ будет выглядеть следующим образом:   

```
{  
    "id": 1,  
    "name": "Красная шапочка",  
    "year": 1697,  
    "rating": 0,  
    "description": "Старинное произведение Ш.Перро",  
    "genre": [  
        "name": "сказка",  
        "slug": "tale"  
    ],  
    "category": {  
        "name": "книга",  
        "slug": "book"  
    } 
} 
```

### Получаем отзыв по id для указанного произведения.
Передаем GET-запрос на адрес http://127.0.0.1:8000/api/v1/titles/{title_id}/reviews/{review_id}/

Ответ будет выглядеть следующим образом:

```
{  
    "id": review_id,  
    "text": "string",  
    "author": "string",  
    "score": 1,  
    "pub_date": "2019-08-24T14:15:22Z"   
} 
```

### Частично обновляем комментарий к отзыву по id.
Для этого действия вы должны быть автором комментария, модератором или администратором. 
Передаем PATCH запрос на эндпоинт http://127.0.0.1:8000/api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/ с параметром "text": "Измененный текст комментария". 

Ответ будет выглядеть следующим образом:  

```
{ 
    "id": title_id,  
    "text": "Измененный текст комментария",  
    "author": "string",  
    "pub_date": "2019-08-24T14:15:22Z"  
}   
```
### Добавляем новый жанр
Для этого действия необходимо обладать правами администратора.  
Передаем POST запрос на эндпоинт http://127.0.0.1:8000/api/v1/genres/  
Заполняем поля:

```
{
  "name": "ужасы",
  "slug": "horror"
}
```
Ответ будет выглядеть следующим образом:

```
{
  "name": "ужасы",
  "slug": "horror"
}
```


# Документация (запросы для работы с API): http://localhost/redoc/


# для завершения работы нажмите Ctrl+C

### автор Жигулин Олег телеграм @Oleg_Zhigulin
